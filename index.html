<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>7TBRP Diffusion MRI Normative Charts</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial; background: #f5f6fa; margin:0; text-align:center; }
h1 { background:#2c3e50;color:white;margin:0;padding:20px; }

.tab-container { display:flex; justify-content:center; margin-top:20px; flex-wrap:wrap; }
.tab-button { padding:10px 20px; margin:0 5px; border:none; background:#bdc3c7; color:#2c3e50; cursor:pointer; border-radius:5px 5px 0 0; font-weight:bold; transition:0.2s; }
.tab-button.active { background:#2c3e50; color:white; }

.content { display:flex; justify-content:space-between; gap:20px; width:90%; max-width:1000px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); align-items:flex-start; }
#grafico { flex:1; height:500px; }
#opcoes { width:250px; text-align:left; background:#ecf0f1; padding:15px; border-radius:8px; box-shadow: inset 0 0 3px rgba(0,0,0,0.1); font-size:13px; line-height:1.3; }

#opcoes label { display:block; margin-bottom:5px; cursor:pointer; }
#opcoes input, #opcoes select { width:100%; margin-bottom:8px; }
#user-form button { width:100%; padding:5px; background:#2c3e50; color:white; border:none; border-radius:5px; cursor:pointer; margin-top:5px; }
</style>
</head>
<body>
<h1>7TBRP Diffusion MRI Normative Charts</h1>

<div class="tab-container">
  <button class="tab-button active" onclick="mostrarAba('DTI', event)">DTI</button>
  <button class="tab-button" onclick="mostrarAba('DKI', event)">DKI</button>
  <button class="tab-button" onclick="mostrarAba('NODDI', event)">NODDI</button>
</div>

<div class="content">
  <div id="opcoes"></div>
  <div id="grafico"></div>
</div>

<script>
// dados de exemplo
const ROIs = ['ROI1','ROI2','ROI3','ROI4','ROI5','ROI6','ROI7','ROI8','ROI9','ROI10'];
const dados = {
  DTI: { 'AD': {}, 'MD': {}, 'FA': {} },
  DKI: { 'AK': {}, 'MK': {}, 'RK': {} },
  NODDI: { 'ODI': {}, 'NDI': {}, 'FWF': {} }
};

// preenche valores fictícios para cada ROI x métrica
for (let aba in dados) {
  for (let metrica in dados[aba]) {
    ROIs.forEach((roi,i) => {
      dados[aba][metrica][roi] = { x:[1,2,3,4], y:[Math.random()*10+5,Math.random()*10+5,Math.random()*10+5,Math.random()*10+5], type:'scatter', name:`${roi} - ${metrica}` };
    });
  }
}

const userCurves = { DTI:{}, DKI:{}, NODDI:{} };
const userColors = ['red','green','blue','orange','purple','brown','pink'];
let colorIndex = 0;

// desenhar gráfico com as métricas e ROIs selecionadas
function desenhar(aba) {
  const metricaSelecionadas = [...document.getElementById('metricas').selectedOptions].map(o=>o.value);
  const roiSelecionadas = [...document.getElementById('rois').selectedOptions].map(o=>o.value);

  let data = [];

  metricaSelecionadas.forEach(m=>{
    roiSelecionadas.forEach(r=>{
      if(dados[aba][m] && dados[aba][m][r]) data.push(dados[aba][m][r]);
    });
  });

  // adiciona curvas do usuário
  const todasCurvasUser = userCurves[aba];
  Object.keys(todasCurvasUser).forEach(nome=>{
    data.push(todasCurvasUser[nome]);
  });

  Plotly.newPlot('grafico', data, { title: `${aba} Metrics`, margin:{t:50}, paper_bgcolor:'white', plot_bgcolor:'white' }, {responsive:true});
}

// criar painel lateral
function criarPainel(aba){
  const container = document.getElementById('opcoes');
  container.innerHTML = `<h3>${aba}</h3>`;

  // dropdown múltiplo de métricas
  const selMetricas = document.createElement('select');
  selMetricas.id = 'metricas';
  selMetricas.multiple = true;
  for(let m in dados[aba]) {
    const opt = document.createElement('option'); opt.value=m; opt.textContent=m; opt.selected=true;
    selMetricas.appendChild(opt);
  }
  selMetricas.addEventListener('change', ()=>desenhar(aba));
  container.appendChild(document.createTextNode('Métricas:'));
  container.appendChild(selMetricas);

  // dropdown múltiplo de ROIs
  const selROIs = document.createElement('select');
  selROIs.id='rois'; selROIs.multiple=true;
  ROIs.forEach(r=>{ const opt=document.createElement('option'); opt.value=r; opt.textContent=r; opt.selected=true; selROIs.appendChild(opt); });
  selROIs.addEventListener('change', ()=>desenhar(aba));
  container.appendChild(document.createTextNode('ROIs:'));
  container.appendChild(selROIs);

  // formulário usuário
  const form = document.createElement('div');
  form.id='user-form';
  form.innerHTML = `
    <h4>Adicionar sua curva</h4>
    X (vírgula): <input type="text" id="user-x" placeholder="1,2,3,4"><br>
    Y (vírgula): <input type="text" id="user-y" placeholder="10,15,13,17"><br>
    Nome: <input type="text" id="user-name" placeholder="Minha Curva"><br>
    <button onclick="adicionarCurva('${aba}')">Adicionar curva</button>
  `;
  container.appendChild(form);
}

// adicionar curva do usuário com marcador quadrado, linha pontilhada e cor automática
function adicionarCurva(aba){
  const xStr=document.getElementById('user-x').value;
  const yStr=document.getElementById('user-y').value;
  const nome=document.getElementById('user-name').value || 'Minha Curva';

  if(!xStr || !yStr){alert('Preencha X e Y!'); return;}
  const x=xStr.split(',').map(Number);
  const y=yStr.split(',').map(Number);
  if(x.length!==y.length){alert('X e Y devem ter o mesmo tamanho!'); return;}

  const cor=userColors[colorIndex%userColors.length]; colorIndex+=1;
  userCurves[aba][nome]={ x, y, type:'scatter', name:nome, mode:'lines+markers', line:{dash:'dot', width:2}, marker:{size:8,symbol:'square', color:cor} };

  desenhar(aba);
}

// alterna abas
function mostrarAba(aba,event){
  document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  criarPainel(aba);
  desenhar(aba);
}

// inicializa
criarPainel('DTI'); desenhar('DTI');
</script>
</body>
</html>
