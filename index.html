<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>7TBRP Diffusion MRI Normative Charts</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    background-color: #fafafa;
    color: #333;
  }

  header {
    background: #004d7a;
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 22px;
    font-weight: 600;
  }

  .container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    padding: 20px;
  }

  .metrics, .rois {
    flex: 1;
    min-width: 180px;
    max-height: 400px;
    overflow-y: auto;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-size: 13px;
  }

  .metrics label, .rois label {
    display: block;
    margin-bottom: 4px;
  }

  .graph-container {
    flex: 3;
    min-width: 400px;
    height: 600px;
  }

  .custom-curve {
    width: 100%;
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-size: 13px;
  }

  .custom-curve div {
    flex: 1;
    min-width: 180px;
  }

  input, button {
    width: 100%;
    margin: 5px 0;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  button {
    background: #004d7a;
    color: white;
    cursor: pointer;
    font-weight: 600;
  }

  button:hover {
    background: #006699;
  }
</style>
</head>
<body>
<header>7TBRP Diffusion MRI Normative Charts</header>

<div class="container">
  <div class="metrics">
    <label for="metricas"><strong>Diffusion Metrics:</strong></label>
    <select id="metricas" multiple size="8">
      <option value="DTI-Fractional Anisotropy (FA)" selected>DTI-Fractional Anisotropy (FA)</option>
      <option value="DTI-Axial Diffusivity (AD)">DTI-Axial Diffusivity (AD)</option>
      <option value="DTI-Mean Diffusivity (MD)">DTI-Mean Diffusivity (MD)</option>
      <option value="DTI-Radial Diffusivity (RD)">DTI-Radial Diffusivity (RD)</option>
      <option value="DKI-Axial Kurtosis (AK)">DKI-Axial Kurtosis (AK)</option>
      <option value="DKI-Mean Kurtosis (MK)">DKI-Mean Kurtosis (MK)</option>
      <option value="DKI-Radial Kurtosis (RK)">DKI-Radial Kurtosis (RK)</option>
      <option value="NODDI-Orientation Dispersion Index (ODI)">NODDI-Orientation Dispersion Index (ODI)</option>
      <option value="NODDI-Neurite Density Index (NDI)">NODDI-Neurite Density Index (NDI)</option>
      <option value="NODDI-Free Water Fraction (FWF)">NODDI-Free Water Fraction (FWF)</option>
    </select>
  </div>

  <div class="rois">
    <strong>ROIs:</strong><br>
    <label><input type="checkbox" value="Corpus Callosum" checked> Corpus Callosum</label>
    <label><input type="checkbox" value="Corticospinal Tract"> Corticospinal Tract</label>
    <label><input type="checkbox" value="Cingulum"> Cingulum</label>
    <label><input type="checkbox" value="Thalamus"> Thalamus</label>
    <label><input type="checkbox" value="Internal Capsule"> Internal Capsule</label>
    <label><input type="checkbox" value="Optic Radiation"> Optic Radiation</label>
    <label><input type="checkbox" value="Superior Longitudinal Fasciculus"> SLF</label>
    <label><input type="checkbox" value="Inferior Fronto-Occipital Fasciculus"> IFOF</label>
    <label><input type="checkbox" value="Arcuate Fasciculus"> Arcuate</label>
    <label><input type="checkbox" value="Fornix"> Fornix</label>
    <label><input type="checkbox" value="Uncinate Fasciculus"> Uncinate</label>
    <label><input type="checkbox" value="Cerebellar Peduncle"> Cerebellar Peduncle</label>
  </div>

  <div class="graph-container" id="graph"></div>

  <div class="custom-curve">
    <div>
      <label>X (comma separated)</label>
      <input type="text" id="xvalues" placeholder="ex: 0,10,20,30">
    </div>
    <div>
      <label>Y (comma separated)</label>
      <input type="text" id="yvalues" placeholder="ex: 0.5,0.6,0.7,0.8">
    </div>
    <div>
      <label>Name</label>
      <input type="text" id="curvename" placeholder="Minha Curva">
      <button onclick="addCustomCurve()">Adicionar Curva</button>
    </div>
  </div>
</div>

<script>
const userCurves = [];
const userColors = ['red','green','blue','orange','purple','brown','pink'];
let colorIndex = 0;

function getSelectedValues(containerClass) {
  return Array.from(document.querySelectorAll(`.${containerClass} input:checked`)).map(el => el.value);
}

function plotGraph() {
  const metrics = getSelectedValues('metrics');
  const rois = getSelectedValues('rois');

  const traces = [];
  const x = [0,10,20,30,40,50];

  for (let m of metrics) {
    for (let r of rois) {
      const y = x.map(() => Math.random()*0.2 + 0.4); // dados fictícios
      traces.push({ x, y, mode:'lines', name:`${r} - ${m}`, line:{width:2} });
    }
  }

  // adicionar curvas do usuário
  userCurves.forEach(c => traces.push(c));

  Plotly.newPlot('graph', traces, {
    margin:{t:40,l:50,r:10,b:50},
    height:600,
    xaxis:{title:'Idade'},
    yaxis:{title:'Valor da Métrica'},
    showlegend:true
  });
}

function addCustomCurve() {
  const xInput = document.getElementById('xvalues').value;
  const yInput = document.getElementById('yvalues').value;
  const name = document.getElementById('curvename').value || 'User Curve';

  const x = xInput.split(',').map(Number);
  const y = yInput.split(',').map(Number);

  if(x.length !== y.length || x.some(isNaN) || y.some(isNaN)) {
    alert('Valores inválidos! Verifique X e Y.');
    return;
  }

  const color = userColors[colorIndex % userColors.length];
  colorIndex += 1;

  userCurves.push({
    x, y, mode:'lines+markers', name,
    line:{dash:'dot', width:2, color},
    marker:{symbol:'square', size:8, color}
  });

  plotGraph();
}

// atualizar gráfico quando mudar checkboxes
document.querySelectorAll('.metrics input, .rois input').forEach(el=>{
  el.addEventListener('change', plotGraph);
});

// plot inicial
plotGraph();
</script>
</body>
</html>
