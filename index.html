<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>7TBRP Diffusion MRI Normative Charts</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial; background: #f5f6fa; margin:0; text-align:center; }
h1 { background:#2c3e50;color:white;margin:0;padding:20px; }

.tab-container { display:flex; justify-content:center; margin-top:20px; flex-wrap:wrap; }
.tab-button { padding:10px 20px; margin:0 5px; border:none; background:#bdc3c7; color:#2c3e50; cursor:pointer; border-radius:5px 5px 0 0; font-weight:bold; transition:0.2s; }
.tab-button.active { background:#2c3e50; color:white; }

.content { display:flex; justify-content:space-between; gap:20px; width:95%; max-width:1500px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); align-items:flex-start; }

#grafico { flex-grow:2; flex-basis:900px; height:750px; } /* Gráfico mais largo e mais alto */
#opcoes { width:300px; text-align:left; background:#ecf0f1; padding:15px; border-radius:8px; box-shadow: inset 0 0 3px rgba(0,0,0,0.1); font-size:13px; line-height:1.3; }

#opcoes label { display:block; margin-bottom:5px; cursor:pointer; }
#opcoes input, #opcoes select { width:100%; margin-bottom:8px; }
#rois { height:300px; }  /* Mostra mais linhas */
#metricas { height:100px; }

#user-form { margin-top:10px; }
#user-toggle { background:#2c3e50; color:white; border:none; padding:6px 10px; border-radius:5px; width:100%; cursor:pointer; font-weight:bold; }
#user-fields { display:none; margin-top:8px; }
#user-fields input { width:100%; margin-bottom:5px; }
#user-fields button { width:100%; padding:5px; background:#2c3e50; color:white; border:none; border-radius:5px; cursor:pointer; }
</style>

</head>
<body>
<h1>7TBRP Diffusion MRI Normative Charts</h1>

<div class="tab-container">
  <button class="tab-button active" onclick="mostrarAba('DTI', event)">DTI</button>
  <button class="tab-button" onclick="mostrarAba('DKI', event)">DKI</button>
  <button class="tab-button" onclick="mostrarAba('NODDI', event)">NODDI</button>
</div>

<div class="content">
  <div id="opcoes"></div>
  <div id="grafico"></div>
</div>

<script>
const ROIs = [
  'AF-L: Arcuate fascicle (L)',
  'AF-R: Arcuate fascicle (R)',
  'ATR-L: Anterior Thalamic Radiation (L)',
  'ATR-R: Anterior Thalamic Radiation (R)',
  'CA: Commissure Anterior',
  'CC-1: Rostrum',
  'CC-2: Genu',
  'CC-3: Rostral Body (PreMotor)',
  'CC-4: Anterior midbody (Primary Motor)',
  'CC-5: Posterior midbody (Primary Somatosensory)',
  'CC-6: Isthmus',
  'CC-7: Splenium',
  'CG-L: Cingulum (L)',
  'CG-R: Cingulum (R)',
  'CST-L: Corticospinal tract (L)',
  'CST-R: Corticospinal tract (R)',
  'MLF-L: Middle longitudinal fascicle (L)',
  'MLF-R: Middle longitudinal fascicle (R)',
  'FPT-L: Fronto-pontine tract (L)',
  'FPT-R: Fronto-pontine tract (R)',
  'FX-L: Fornix (L)',
  'FX-R: Fornix (R)',
  'ICP-L: Inferior cerebellar peduncle (L)',
  'ICP-R: Inferior cerebellar peduncle (R)',
  'IFO-L: Inferior occipito-frontal fascicle (L)',
  'IFO-R: Inferior occipito-frontal fascicle (R)',
  'ILF-L: Inferior longitudinal fascicle (L)',
  'ILF-R: Inferior longitudinal fascicle (R)',
  'MCP: Middle cerebellar peduncle',
  'OR-L: Optic radiation (L)',
  'OR-R: Optic radiation (R)',
  'POPT-L: Parieto‐occipital pontine (L)',
  'POPT-R: Parieto‐occipital pontine (R)',
  'SCP-L: Superior cerebellar peduncle (L)',
  'SCP-R: Superior cerebellar peduncle (R)',
  'SLF-I-L: Superior longitudinal fascicle I (L)',
  'SLF-I-R: Superior longitudinal fascicle I (R)',
  'SLF-II-L: Superior longitudinal fascicle II (L)',
  'SLF-II-R: Superior longitudinal fascicle II (R)',
  'SLF-III-L: Superior longitudinal fascicle III (L)',
  'SLF-III-R: Superior longitudinal fascicle III (R)',
  'STR-L: Superior Thalamic Radiation (L)',
  'STR-R: Superior Thalamic Radiation (R)',
  'UF-L: Uncinate fascicle (L)',
  'UF-R: Uncinate fascicle (R)',
  'CC: Corpus Callosum',
  'T_PREF-L: Thalamo-prefrontal (L)',
  'T_PREF-R: Thalamo-prefrontal (R)',
  'T_PREM-L: Thalamo-premotor (L)',
  'T_PREM-R:Thalamo-premotor (R)',
  'T_PREC-L: Thalamo-precentral (L)',
  'T_PREC-R: Thalamo-precentral (R)',
  'T_POSTC-L: Thalamo-postcentral (L)',
  'T_POSTC-R: Thalamo-postcentral (R)',
  'T-PAR-L: Thalamo-parietal (L)',
  'T-PAR-R: Thalamo-parietal (R)',
  'T-OCC-L: Thalamo-occipital (L)',
  'T-OCC-R: Thalamo-occipital (R)',
  'ST-FO-L: Striato-fronto-orbital (L)',
  'ST-FO-R: Striato-fronto-orbital (R)',
  'ST-PREF-L: Striato-prefrontal (L)',
  'ST-PREF-R: Striato-prefrontal (R)',
  'ST-PREM-L: Striato-premotor (L)',
  'ST-PREM-R: Striato-premotor (R)',
  'ST-PREC-L: Striato-precentral (L)',
  'ST-PREC-R: Striato-precentral (R)',
  'ST-POSTC-L: Striato-postcentral (L)',
  'ST-POSTC-R: Striato-postcentral (R)',
  'ST-PAR-L: Striato-parietal (L)',
  'ST-PAR-R:Striato-parietal (R)',
  'ST-OCC-L:Striato-occipital (L)',
  'ST-OCC-R:Striato-occipital (R)'
];
const dados = {
  DTI: { 'AD': {}, 'MD': {}, 'FA': {} },
  DKI: { 'AK': {}, 'MK': {}, 'RK': {} },
  NODDI: { 'ODI': {}, 'NDI': {}, 'FWF': {} }
};

// preenche valores fictícios para cada ROI x métrica
for (let aba in dados) {
  for (let metrica in dados[aba]) {
    ROIs.forEach((roi,i) => {
      dados[aba][metrica][roi] = { x:[1,2,3,4], y:[Math.random()*10+5,Math.random()*10+5,Math.random()*10+5,Math.random()*10+5], type:'scatter', name:`${roi} - ${metrica}` };
    });
  }
}

const userCurves = { DTI:{}, DKI:{}, NODDI:{} };
const userColors = ['red','green','blue','orange','purple','brown','pink'];
let colorIndex = 0;

// desenhar gráfico com as métricas e ROIs selecionadas
function desenhar(aba) {
  const metricaSelecionadas = [...document.getElementById('metricas').selectedOptions].map(o=>o.value);
  const roiSelecionadas = [...document.getElementById('rois').selectedOptions].map(o=>o.value);

  let data = [];

  metricaSelecionadas.forEach(m=>{
    roiSelecionadas.forEach(r=>{
      if(dados[aba][m] && dados[aba][m][r]) data.push(dados[aba][m][r]);
    });
  });

  // adiciona curvas do usuário
  const todasCurvasUser = userCurves[aba];
  Object.keys(todasCurvasUser).forEach(nome=>{
    data.push(todasCurvasUser[nome]);
  });

  Plotly.newPlot('grafico', data, { title: `${aba} Metrics`, margin:{t:50}, paper_bgcolor:'white', plot_bgcolor:'white' }, {responsive:true});
}

// criar painel lateral
function criarPainel(aba){
  const container = document.getElementById('opcoes');
  container.innerHTML = `<h3>${aba}</h3>`;

  // dropdown múltiplo de métricas
  const selMetricas = document.createElement('select');
  selMetricas.id = 'metricas';
  selMetricas.multiple = true;
  for(let m in dados[aba]) {
    const opt = document.createElement('option'); opt.value=m; opt.textContent=m; opt.selected=true;
    selMetricas.appendChild(opt);
  }
  selMetricas.addEventListener('change', ()=>desenhar(aba));
  container.appendChild(document.createTextNode('Metrics:'));
  container.appendChild(selMetricas);

  // dropdown múltiplo de ROIs
  const selROIs = document.createElement('select');
  selROIs.id='rois'; selROIs.multiple=true;
  ROIs.forEach(r=>{ const opt=document.createElement('option'); opt.value=r; opt.textContent=r; opt.selected=true; selROIs.appendChild(opt); });
  selROIs.addEventListener('change', ()=>desenhar(aba));
  container.appendChild(document.createTextNode('ROIs:'));
  container.appendChild(selROIs);

// formulário usuário (escondido por padrão)
const form = document.createElement('div');
form.id = 'user-form';
form.innerHTML = `
  <button id="user-toggle" onclick="toggleUserFields()">➕ Add your plot</button>
  <div id="user-fields">
    X (comma): <input type="text" id="user-x" placeholder="1,2,3,4"><br>
    Y (comma): <input type="text" id="user-y" placeholder="10,15,13,17"><br>
    Nome: <input type="text" id="user-name" placeholder="Minha Curva"><br>
    <button onclick="adicionarCurva('${aba}')">Add curve</button>
  </div>
`;
container.appendChild(form);

function toggleUserFields() {
  const fields = document.getElementById('user-fields');
  fields.style.display = (fields.style.display === 'none' || !fields.style.display) ? 'block' : 'none';
}


// adicionar curva do usuário com marcador quadrado, linha pontilhada e cor automática
function adicionarCurva(aba){
  const xStr=document.getElementById('user-x').value;
  const yStr=document.getElementById('user-y').value;
  const nome=document.getElementById('user-name').value || 'User Plot';

  if(!xStr || !yStr){alert('Add your X and Y data!'); return;}
  const x=xStr.split(',').map(Number);
  const y=yStr.split(',').map(Number);
  if(x.length!==y.length){alert('X and Y arrays must have the same size!'); return;}

  const cor=userColors[colorIndex%userColors.length]; colorIndex+=1;
  userCurves[aba][nome]={ x, y, type:'scatter', name:nome, mode:'lines+markers', line:{dash:'dot', width:2}, marker:{size:8,symbol:'square', color:cor} };

  desenhar(aba);
}

// alterna abas
function mostrarAba(aba,event){
  document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  criarPainel(aba);
  desenhar(aba);
}

// inicializa
criarPainel('DTI'); desenhar('DTI');
</script>
</body>
</html>
